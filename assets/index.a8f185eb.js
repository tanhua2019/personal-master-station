import{F as V,h as P,a as O,v as X,E as N,b as Q}from"./validate.7d47b83c.js";import{h as j,W as B,r as T,o as L,a as I,k as v,i as _,X as G,Y,Z as D,$ as q,v as W,x as H,a0 as R,a1 as J,a2 as Z,a3 as K,a4 as ee,O as te,A as oe,g as z,j as A,u as C,b as ne,d as se,a5 as ie,l as re}from"./index.ea741418.js";(function(){function g(e){var s=document.getElementById(e.id),t=typeof e=="object"&&e;return new l(s,t)}var x=function(){var e=arguments.length,s=arguments[0]||{},t,r,a;for(typeof s!="object"&&typeof s!="function"&&(s={}),e==1&&(s=this,t--),t=1;t<e;t++){r=arguments[t];for(a in r)Object.prototype.hasOwnProperty.call(r,a)&&(s[a]=r[a])}return s},i=function(e){return typeof e=="function"&&typeof e.nodeType!="number"},l=function(e,s){this.$element=e,this.options=x({},l.DEFAULTS,s),this.$element.style.position="relative",this.$element.style.width=this.options.width+"px",this.$element.style.margin="0 auto",this.init()},h;l.VERSION="1.0",l.Author="imooc_front@163.com",l.DEFAULTS={width:280,height:155,PI:Math.PI,sliderL:42,sliderR:9,offset:5,loadingText:"\u6B63\u5728\u52A0\u8F7D\u4E2D...",failedText:"\u518D\u8BD5\u4E00\u6B21",barText:"\u5411\u53F3\u6ED1\u52A8\u586B\u5145\u62FC\u56FE",repeatIcon:"iconfont iconfont-shuaxin",maxLoadCount:3,localImages:function(){return"images/Pic"+Math.round(Math.random()*4)+".jpg"},verify:function(e,s){var t=!1;return $.ajax({url:s,data:{datas:JSON.stringify(e)},dataType:"json",type:"post",async:!1,success:function(r){t=JSON.stringify(r),console.log("\u8FD4\u56DE\u7ED3\u679C\uFF1A"+t)}}),t},remoteUrl:""},window.sliderCaptcha=g,window.sliderCaptcha.Constructor=l,h=l.prototype,h.init=function(){this.initDOM(),this.initImg(),this.bindEvents()},h.initDOM=function(){var e=function(b,S){var k=document.createElement(b);return k.className=S,k},s=function(b,S){var k=document.createElement("canvas");return k.width=b,k.height=S,k},t=s(this.options.width-2,this.options.height),r=t.cloneNode(!0),a=e("div","sliderContainer"),d=e("i","refreshIcon "+this.options.repeatIcon),c=e("div","sliderMask"),n=e("div","sliderbg"),o=e("div","slider"),p=e("i","iconfont icon-arrow-right sliderIcon"),u=e("span","sliderText"),m,f;r.className="slider-captcha-block",u.innerHTML=this.options.barText,m=this.$element,m.appendChild(t),m.appendChild(d),m.appendChild(r),o.appendChild(p),c.appendChild(o),a.appendChild(n),a.appendChild(c),a.appendChild(u),m.appendChild(a),f={canvas:t,block:r,sliderContainer:a,refreshIcon:d,slider:o,sliderMask:c,sliderIcon:p,text:u,canvasCtx:t.getContext("2d"),blockCtx:r.getContext("2d")},i(Object.assign)?Object.assign(this,f):x(this,f)},h.initImg=function(){var e=this,s=window.navigator.userAgent.indexOf("Trident")>-1,t=this.options.sliderL+this.options.sliderR*2+3,r=function(n,o){var p=e.options.sliderL,u=e.options.sliderR,m=e.options.PI,f=e.x,b=e.y;n.beginPath(),n.moveTo(f,b),n.arc(f+p/2,b-u+2,u,.72*m,2.26*m),n.lineTo(f+p,b),n.arc(f+p+u-2,b+p/2,u,1.21*m,2.78*m),n.lineTo(f+p,b+p),n.lineTo(f,b+p),n.arc(f+u-2,b+p/2,u+.4,2.76*m,1.24*m,!0),n.lineTo(f,b),n.lineWidth=2,n.fillStyle="rgba(255, 255, 255, 0.7)",n.strokeStyle="rgba(255, 255, 255, 0.7)",n.stroke(),n[o](),n.globalCompositeOperation=s?"xor":"destination-over"},a=function(n,o){return Math.round(Math.random()*(o-n)+n)},d=new Image,c;d.crossOrigin="Anonymous",c=0,d.onload=function(){e.x=a(t+10,e.options.width-(t+10)),e.y=a(10+e.options.sliderR*2,e.options.height-(t+10)),r(e.canvasCtx,"fill"),r(e.blockCtx,"clip"),e.canvasCtx.drawImage(d,0,0,e.options.width-2,e.options.height),e.blockCtx.drawImage(d,0,0,e.options.width-2,e.options.height);var n=e.y-e.options.sliderR*2-1,o=e.blockCtx.getImageData(e.x-3,n,t,t);e.block.width=t,e.blockCtx.putImageData(o,0,n+1),e.text.textContent=e.text.getAttribute("data-text")},d.onerror=function(){if(c++,window.location.protocol==="file:"&&(c=e.options.maxLoadCount,console.error("can't load pic resource file from File protocal. Please try http or https")),c>=e.options.maxLoadCount){e.text.textContent="\u52A0\u8F7D\u5931\u8D25",e.classList.add("text-danger");return}d.src=e.options.localImages()},d.setSrc=function(){var n="",o;c=0,e.text.classList.remove("text-danger"),i(e.options.setSrc)&&(n=e.options.setSrc()),n&&n!==""||(n="https://picsum.photos/"+e.options.width+"/"+e.options.height+"/?image="+Math.round(Math.random()*200)),s?(o=new XMLHttpRequest,o.onloadend=function(p){var u=new FileReader;u.readAsDataURL(p.target.response),u.onloadend=function(m){d.src=m.target.result}},o.open("GET",n),o.responseType="blob",o.send()):d.src=n},d.setSrc(),this.text.setAttribute("data-text",this.options.barText),this.text.textContent=this.options.loadingText,this.img=d},h.clean=function(){this.canvasCtx.clearRect(0,0,this.options.width,this.options.height),this.blockCtx.clearRect(0,0,this.options.width,this.options.height),this.block.width=this.options.width},h.bindEvents=function(){var e=this;this.$element.addEventListener("selectstart",function(){return!1}),this.refreshIcon.addEventListener("click",function(){e.text.textContent=e.options.barText,e.reset(),i(e.options.onRefresh)&&e.options.onRefresh.call(e.$element)});var s,t,r=[],a=!1,d=function(o){e.text.classList.contains("text-danger")||(s=o.clientX||o.touches[0].clientX,t=o.clientY||o.touches[0].clientY,a=!0)},c=function(o){var p;if(!a)return!1;var u=o.clientX||o.touches[0].clientX,m=o.clientY||o.touches[0].clientY,f=u-s,b=m-t;if(f<0||f+40>e.options.width)return!1;e.slider.style.left=f-1+"px",p=(e.options.width-60)/(e.options.width-40)*f,e.block.style.left=p+"px",e.sliderContainer.classList.add("sliderContainer_active"),e.sliderMask.style.width=f+4+"px",r.push(Math.round(b))},n=function(o){var p,u;if(!a||(a=!1,p=o.clientX||o.changedTouches[0].clientX,p===s))return!1;e.sliderContainer.classList.remove("sliderContainer_active"),e.trail=r,u=e.verify(),u.spliced&&u.verified?(e.sliderContainer.classList.add("sliderContainer_success"),i(e.options.onSuccess)&&e.options.onSuccess.call(e.$element,r)):(e.sliderContainer.classList.add("sliderContainer_fail"),i(e.options.onFail)&&e.options.onFail.call(e.$element),setTimeout(function(){e.text.innerHTML=e.options.failedText,e.reset()},1e3))};this.slider.addEventListener("mousedown",d),this.slider.addEventListener("touchstart",d),document.addEventListener("mousemove",c),document.addEventListener("touchmove",c),document.addEventListener("mouseup",n),document.addEventListener("touchend",n),document.addEventListener("mousedown",function(){return!1}),document.addEventListener("touchstart",function(){return!1}),document.addEventListener("swipe",function(){return!1})},h.verify=function(){var e=this.trail,s=parseInt(this.block.style.left),t=!1;if(this.options.remoteUrl!==null)t=this.options.verify(e,this.options.remoteUrl);else{var r=function(o,p){return o+p},a=function(o){return o*o},d=e.reduce(r)/e.length,c=e.map(function(o){return o-d}),n=Math.sqrt(c.map(a).reduce(r)/e.length);t=n!==0}return{spliced:Math.abs(s-this.x)<this.options.offset,verified:t}},h.reset=function(){this.sliderContainer.classList.remove("sliderContainer_fail"),this.sliderContainer.classList.remove("sliderContainer_success"),this.slider.style.left=0,this.block.style.left=0,this.sliderMask.style.width=0,this.clean(),this.text.setAttribute("data-text",this.text.textContent),this.text.textContent=this.options.loadingText,this.img.setSrc()}})();const ae={class:"fixed top-[20%] left-[50%] translate-x-[-50%] w-[340px] h-[270px] text-sm bg-white dark:bg-zinc-800 rounded border border-zinc-200 dark:border-zinc-900 shadow-3xl"},ce={class:"flex items-center h-5 text-left px-1 mb-1"},le=v("span",{class:"flex-grow dark:text-zinc-200"},"\u8BF7\u5B8C\u6210\u5B89\u5168\u9A8C\u8BC1",-1),de=v("div",{id:"captcha"},null,-1),U="close",F="success",pe={__name:"slider-captcha",emits:[U,F],setup(g,{emit:x}){let i=null;j(()=>{i=sliderCaptcha({id:"captcha",async onSuccess(e){await B({behavior:e})&&x(F)},onFail(){console.log("onFail")},verify(){return!0}})});const l=()=>{i.reset()},h=()=>{x(U)};return(e,s)=>{const t=T("m-svg-icon");return L(),I("div",ae,[v("div",ce,[le,_(t,{name:"refresh",fillClass:"fill-zinc-900 dark:fill-zinc-200",class:"w-3 h-3 p-0.5 rounded-sm duration-300 cursor-pointer hover:bg-zinc-200 dark:hover:bg-zinc-900",onClick:l}),_(t,{name:"close",fillClass:"fill-zinc-900 dark:fill-zinc-200",class:"ml-2 w-3 h-3 p-0.5 rounded-sm duration-300 cursor-pointer hover:bg-zinc-200 dark:hover:bg-zinc-900",onClick:h})]),de])}}},E="LOGIN_SUCCESS_CHANNEL";let w=null;window.BroadcastChannel&&(w=new BroadcastChannel(E));const ue=()=>new Promise((g,x)=>{w?w.onmessage=async i=>{g(i.data)}:window.onstorage=i=>{i.key===E&&g(JSON.parse(i.newValue))}}),he=g=>{w?w.postMessage(g):localStorage.setItem(E,JSON.stringify(g))},fe=()=>{w&&(w.close(),w=null),localStorage.removeItem(E)};var y={wait:ue,send:he,clear:fe};const M=async(g,x)=>{if(await G.dispatch("user/login",{loginType:g,...x})===Y){D("success",`\u6B22\u8FCE\u60A8 ${x.nickname}\uFF0C\u8BF7\u521B\u5EFA\u60A8\u7684\u8D26\u53F7`,6e3),q.push({path:"/register",query:{reqType:g,...x}});return}q.push("/")},xe={id:"qqLoginBtn"},me="https://graph.qq.com/oauth2.0/authorize?client_id=101998494&response_type=token&scope=all&redirect_uri=https%3A%2F%2Fimooc-front.lgdsunday.club%2Flogin",ge={__name:"qq-login",setup(g){j(()=>{QC.Login({btnId:"qqLoginBtn"},(l,h)=>{console.log("QQ\u767B\u5F55\u6210\u529F"),QC.Login.signOut();const e=/access_token=((.*))&expires_in/.exec(window.location.hash)[1],s={nickname:l.nickname,figureurl_qq_2:l.figureurl_qq_2,accessToken:e};y.send(s),M(R,s),window.close()})});const x=()=>{i()},i=async()=>{window.open(me,"oauth2Login_10609","height=525,width=585, toolbar=no, menubar=no, scrollbars=no, status=no, location=yes, resizable=yes"),y.wait().then(async l=>{y.clear(),M(R,l)})};return(l,h)=>{const e=T("m-svg-icon");return L(),I("div",null,[W(v("span",xe,null,512),[[H,!1]]),_(e,{class:"w-4 cursor-pointer",name:"qq",onClick:x})])}}},be=v("div",{id:"login_container"},null,-1),_e={__name:"weixin-login",setup(g){if(window.location.search){const i=/code=((.*))&state/.exec(window.location.search)[1];i&&(y.send({code:i}),window.close())}const x=async()=>{const{appId:i,appSecret:l,redirectUri:h,scope:e,state:s}=await J();window.open(`https://open.weixin.qq.com/connect/qrconnect?appid=${i}&redirect_uri=${h}&response_type=code&scope=${e}&state=${s}#wechat_redirect`,"","height=525,width=585, toolbar=no, menubar=no, scrollbars=no, status=no, location=yes, resizable=yes"),y.wait().then(async({code:t})=>{console.log("\u5FAE\u4FE1\u626B\u7801\u767B\u5F55\u6210\u529F"),console.log(t),y.clear();const{access_token:r,openid:a}=await Z(i,l,t);console.log("access_token, openid"),console.log(r,a);const{nickname:d,headimgurl:c}=await K(r,a);console.log(d,c),M(ee,{openid:a,nickname:d,headimgurl:c})})};return(i,l)=>{const h=T("m-svg-icon");return L(),I("div",{onClick:x},[_(h,{class:"w-4 cursor-pointer",name:"wexin"}),be])}}},ve={class:"relative h-screen bg-white dark:bg-zinc-800 text-center xl:bg-zinc-200"},we={class:"block px-3 mt-4 dark:bg-zinc-800 xl:bg-white xl:w-[388px] xl:dark:bg-zinc-900 xl:m-auto xl:mt-8 xl:py-4 xl:rounded-sm xl:shadow-lg"},Ce=v("h3",{class:"mb-2 font-semibold text-base text-main dark:text-zinc-300 hidden xl:block"}," \u8D26\u53F7\u767B\u5F55 ",-1),ke=re(" \u767B\u5F55 "),ye={class:"flex justify-around mt-4"},Le={name:"login"},Ee=Object.assign(Le,{setup(g){const x=te(),i=oe(),l=z(!1),h=()=>{l.value=!0},e=async()=>{l.value=!1,r()},s=z(!1),t=z({username:"",password:""}),r=async()=>{s.value=!0;try{await x.dispatch("user/login",{...t.value,loginType:ie})}finally{s.value=!1}i.push("/")},a=()=>{x.commit("app/changeRouterType","push"),i.push("/register")};return(d,c)=>{const n=T("m-button");return L(),I("div",ve,[_(P),v("div",we,[Ce,_(C(V),{onSubmit:h},{default:A(()=>[_(C(O),{class:"dark:bg-zinc-800 dark:text-zinc-400 border-b-zinc-400 border-b-[1px] w-full outline-0 pb-1 px-1 text-base focus:border-b-main dark:focus:border-b-zinc-200 xl:dark:bg-zinc-900",name:"username",rules:C(X),type:"text",placeholder:"\u7528\u6237\u540D",autocomplete:"on",modelValue:t.value.username,"onUpdate:modelValue":c[0]||(c[0]=o=>t.value.username=o)},null,8,["rules","modelValue"]),_(C(N),{class:"text-sm text-red-600 block mt-0.5 text-left",name:"username"}),_(C(O),{class:"dark:bg-zinc-800 dark:text-zinc-400 border-b-zinc-400 border-b-[1px] w-full outline-0 pb-1 px-1 text-base focus:border-b-main dark:focus:border-b-zinc-200 xl:dark:bg-zinc-900",name:"password",rules:C(Q),type:"password",placeholder:"\u5BC6\u7801",autocomplete:"on",modelValue:t.value.password,"onUpdate:modelValue":c[1]||(c[1]=o=>t.value.password=o)},null,8,["rules","modelValue"]),_(C(N),{class:"text-sm text-red-600 block mt-0.5 text-left",name:"password"}),v("div",{class:"pt-1 pb-3 leading-[0px] text-right"},[v("a",{class:"inline-block p-1 text-zinc-400 text-right dark:text-zinc-600 hover:text-zinc-600 dark:hover:text-zinc-400 text-sm duration-400 cursor-pointer",onClick:a}," \u53BB\u6CE8\u518C ")]),_(n,{class:"w-full dark:bg-zinc-900 xl:dark:bg-zinc-800",loading:s.value,isActiveAnim:!1},{default:A(()=>[ke]),_:1},8,["loading"])]),_:1}),v("div",ye,[_(ge),_(_e)])]),l.value?(L(),ne(pe,{key:0,onClose:c[2]||(c[2]=o=>l.value=!1),onSuccess:e})):se("",!0)])}}});export{Ee as default};
